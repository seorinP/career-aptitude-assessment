{"ast":null,"code":"var _jsxFileName = \"C:\\\\study\\\\career-aptitude-assessment\\\\src\\\\pages\\\\Test\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport * as yup from \"yup\";\nimport { yupResolver } from \"@hookform/resolvers/yup\";\nimport ko from \"yup-locales-ko\";\nimport { useForm } from \"react-hook-form\";\nimport { useCallback, useEffect, useMemo, forwardRef, useRef, useState } from \"react\";\nimport api from \"utils/api\";\nimport { useHistory } from \"react-router-dom\";\nimport { genders } from \"utils/constants\";\nimport styled from 'styled-components';\nimport Landing from '../Landing/index';\nimport TestExample from '../TestExample/index';\nimport QuestionList from \"./QuestionList\";\nimport ProgressBar from \"../../components/ProgressBarComponent\";\nimport Header from '../../components/HeaderComponent';\nimport FooterComponent from '../../components/FooterComponent';\nimport PageMoveButton from '../../components/PageMoveButtonComponent';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nyup.setLocale(ko);\nconst Boundary = styled.div`\n  margin: 4.0rem 4.8rem;\n  height: 100%;\n`;\n_c = Boundary;\nconst Wrapper = styled.div`\n  background: linear-gradient(-20deg, #f794a4 0%, #fdd6bd 100%);\n  \n  height: 100%;\n  width: 100%;\n  padding-top: 0px;\n`;\n_c2 = Wrapper;\nconst Title = styled.div`\n    font-family:'Binggrae-Bold';\n    font-size:1.5rem;\n    text-shadow: 1px 2px 1.5px rgba(0, 0, 0, 0.25);\n    text-align:center;\n    color:#FFFFFF;\n    margin-bottom:2rem;\n`;\n_c3 = Title;\n\nconst Test = () => {\n  _s();\n\n  const history = useHistory();\n  const formRef = useRef(null);\n  const [questions, setQuestions] = useState([]);\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\n  const lastPageIndex = useMemo(() => {\n    return parseInt((questions || []).length / 5, 10) + 2;\n  }, [questions]);\n  const [selectedSampleValue, setSelectedSampleValue] = useState(null);\n  const isQuestionLoaded = useMemo(() => {\n    if (Array.isArray(questions) && questions.length > 0) {\n      return true;\n    }\n\n    return false;\n  }, [questions]);\n  const visibleQuestions = useMemo(() => {\n    if (currentPageIndex <= 1) {\n      return [];\n    }\n\n    return questions.slice((currentPageIndex - 2) * 5, (currentPageIndex - 1) * 5);\n  }, [currentPageIndex, questions]);\n  const formSchema = useMemo(() => {\n    return yup.object().shape({\n      name: yup.string().required(),\n      gender: yup.string().nullable().oneOf(Object.keys(genders), \"성별을 입력해주세요.\"),\n      answers: yup.array().of(yup.string().min(1)).required().length(questions.length),\n      startDtm: yup.number().required()\n    });\n  }, [questions]);\n  const {\n    register,\n    handleSubmit,\n    errors,\n    watch\n  } = useForm({\n    resolver: yupResolver(formSchema),\n    mode: \"onChange\",\n    defaultValues: {\n      name: \"\",\n      gender: \"\",\n      answers: [],\n      startDtm: new Date().getTime()\n    }\n  });\n  const isNextDisabled = useMemo(() => {\n    if (!isQuestionLoaded) {\n      return false;\n    }\n\n    if (currentPageIndex <= 0) {\n      const {\n        gender,\n        name\n      } = watch();\n      return !(name && gender);\n    }\n\n    const answers = watch(\"answers\");\n\n    if (!Array.isArray(answers) || !Array.isArray(visibleQuestions)) {\n      return false;\n    }\n\n    return visibleQuestions.filter(_ref => {\n      let {\n        qitemNo\n      } = _ref;\n      return !answers[qitemNo - 1];\n    }).length > 0;\n  }, [currentPageIndex, isQuestionLoaded, visibleQuestions, watch]);\n  const onSubmit = useCallback(async data => {\n    var _data$answers, _data$answers$sort;\n\n    const {\n      name,\n      gender,\n      startDtm\n    } = data;\n    const answers = data === null || data === void 0 ? void 0 : (_data$answers = data.answers) === null || _data$answers === void 0 ? void 0 : (_data$answers$sort = _data$answers.sort((a, b) => {\n      return parseInt(a, 10) > parseInt(b, 10) ? 1 : -1;\n    })) === null || _data$answers$sort === void 0 ? void 0 : _data$answers$sort.map((answer, index) => {\n      return `B${index + 1}=${answer}`;\n    }).join(\" \");\n    const res = await api.test.submit({\n      name,\n      gender,\n      startDtm,\n      answers\n    });\n\n    if (res === null || res === void 0 ? void 0 : res.url) {\n      const seq = (res.url + \"\").split(\"seq=\").pop();\n\n      if (seq) {\n        history.push(`/completed/${seq}`);\n      }\n    }\n\n    console.log(res);\n  }, [history]);\n  const handlePrevClick = useCallback(() => {\n    setCurrentPageIndex(current => {\n      return current <= 0 ? 0 : current - 1;\n    });\n  }, []);\n  const handleNextClick = useCallback(() => {\n    if (isNextDisabled) {\n      return;\n    }\n\n    setCurrentPageIndex(current => {\n      return current >= lastPageIndex ? lastPageIndex : current + 1;\n    });\n  }, [lastPageIndex, isNextDisabled]);\n  const fetchQuestions = useCallback(async () => {\n    const res = await api.test.getQuestions();\n\n    if (Array.isArray(res)) {\n      setQuestions(res);\n    }\n  }, []);\n  const progressPercentage = useMemo(() => {\n    const answers = watch(\"answers\");\n\n    if (Array.isArray(answers) && answers.length > 0) {\n      return parseInt(answers.filter(answer => {\n        return !!answer;\n      }).length / answers.length * 100, 10);\n    }\n\n    return 0;\n  }, [watch]);\n  const watchUserName = watch(\"name\");\n  const watchUserGender = watch(\"gender\");\n  useEffect(() => {\n    fetchQuestions();\n  }, [fetchQuestions]);\n  useEffect(() => {\n    if (currentPageIndex <= 0) {\n      setSelectedSampleValue(null);\n    }\n  }, [currentPageIndex]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Wrapper, {\n      children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        ref: formRef,\n        noValidate: true,\n        onSubmit: handleSubmit(onSubmit),\n        children: [/*#__PURE__*/_jsxDEV(Landing, {\n          name: watchUserName,\n          gender: watchUserGender,\n          ref: register,\n          pageIndex: currentPageIndex,\n          errors: errors,\n          disabled: isNextDisabled,\n          onClick: handleNextClick\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 9\n        }, this), currentPageIndex === 1 && /*#__PURE__*/_jsxDEV(TestExample, {\n          setSelectedValue: setSelectedSampleValue,\n          initialValue: selectedSampleValue // 지금은 null값이 들어있다.\n          ,\n          disabled: !selectedSampleValue // disabled true로 되어있나?\n          ,\n          pageIndex: currentPageIndex,\n          progressPercentage: progressPercentage,\n          onClick1: handlePrevClick,\n          onClick2: handleNextClick\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Boundary, {\n          children: [currentPageIndex > 1 && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-4\",\n              children: /*#__PURE__*/_jsxDEV(ProgressBar, {\n                text: '검사 진행',\n                percentage: progressPercentage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 231,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(Title, {\n              children: [\"\\uB2E4\\uC74C \\uC120\\uD0DD\\uC9C0\\uC758 \\uC9C1\\uC5C5\\uACFC \\uAD00\\uB828\\uB41C \\uB450 \\uAC1C\\uC758 \\uAC00\\uCE58 \\uC911\\uC5D0\\uC11C \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 39\n              }, this), \" \\uC790\\uC2E0\\uC5D0\\uAC8C \\uB354 \\uC911\\uC694\\uD55C \\uAC00\\uCE58\\uB97C \\uC120\\uD0DD\\uD558\\uC138\\uC694.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 11\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(QuestionList, {\n            questions: questions,\n            visibleQuestions: visibleQuestions,\n            ref: register\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 9\n          }, this), currentPageIndex > 1 && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"button d-flex justify-content-between\",\n              children: [/*#__PURE__*/_jsxDEV(PageMoveButton, {\n                className: \"button\",\n                type: 'previous',\n                disabled: currentPageIndex <= 0,\n                text: '이전',\n                onClick: handlePrevClick\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(PageMoveButton, {\n                className: \"button\",\n                type: currentPageIndex >= lastPageIndex ? \"submit\" : \"button\",\n                disabled: currentPageIndex <= 0,\n                text: currentPageIndex === lastPageIndex ? \"제출\" : \"다음\",\n                onClick: handleNextClick\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 11\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 11\n            }, this)\n          }, void 0, false)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(FooterComponent, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 5\n    }, this)\n  }, void 0, false);\n};\n\n_s(Test, \"kOpIPD/1/g4F1i5wNLaazuRsehk=\", false, function () {\n  return [useHistory, useForm];\n});\n\n_c4 = Test;\nexport default _c5 = /*#__PURE__*/forwardRef(Test);\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"Boundary\");\n$RefreshReg$(_c2, \"Wrapper\");\n$RefreshReg$(_c3, \"Title\");\n$RefreshReg$(_c4, \"Test\");\n$RefreshReg$(_c5, \"%default%\");","map":{"version":3,"sources":["C:/study/career-aptitude-assessment/src/pages/Test/index.js"],"names":["yup","yupResolver","ko","useForm","useCallback","useEffect","useMemo","forwardRef","useRef","useState","api","useHistory","genders","styled","Landing","TestExample","QuestionList","ProgressBar","Header","FooterComponent","PageMoveButton","setLocale","Boundary","div","Wrapper","Title","Test","history","formRef","questions","setQuestions","currentPageIndex","setCurrentPageIndex","lastPageIndex","parseInt","length","selectedSampleValue","setSelectedSampleValue","isQuestionLoaded","Array","isArray","visibleQuestions","slice","formSchema","object","shape","name","string","required","gender","nullable","oneOf","Object","keys","answers","array","of","min","startDtm","number","register","handleSubmit","errors","watch","resolver","mode","defaultValues","Date","getTime","isNextDisabled","filter","qitemNo","onSubmit","data","sort","a","b","map","answer","index","join","res","test","submit","url","seq","split","pop","push","console","log","handlePrevClick","current","handleNextClick","fetchQuestions","getQuestions","progressPercentage","watchUserName","watchUserGender"],"mappings":";;;AAAA,OAAO,KAAKA,GAAZ,MAAqB,KAArB;AACA,SAASC,WAAT,QAA4B,yBAA5B;AACA,OAAOC,EAAP,MAAe,gBAAf;AACA,SAASC,OAAT,QAAwB,iBAAxB;AACA,SAASC,WAAT,EAAsBC,SAAtB,EAAiCC,OAAjC,EAA0CC,UAA1C,EAAsDC,MAAtD,EAA8DC,QAA9D,QAA8E,OAA9E;AACA,OAAOC,GAAP,MAAgB,WAAhB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,OAAT,QAAwB,iBAAxB;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AAEA,OAAOC,OAAP,MAAoB,kBAApB;AACA,OAAOC,WAAP,MAAwB,sBAAxB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,OAAOC,WAAP,MAAwB,uCAAxB;AACA,OAAOC,MAAP,MAAmB,kCAAnB;AACA,OAAOC,eAAP,MAA4B,kCAA5B;AACA,OAAOC,cAAP,MAA2B,0CAA3B;;;AAEApB,GAAG,CAACqB,SAAJ,CAAcnB,EAAd;AAGA,MAAMoB,QAAQ,GAAGT,MAAM,CAACU,GAAK;AAC7B;AACA;AACA,CAHA;KAAMD,Q;AAMN,MAAME,OAAO,GAAGX,MAAM,CAACU,GAAI;AAC3B;AACA;AACA;AACA;AACA;AACA,CANA;MAAMC,O;AAON,MAAMC,KAAK,GAAGZ,MAAM,CAACU,GAAI;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,CAPA;MAAME,K;;AASN,MAAMC,IAAI,GAAG,MAAM;AAAA;;AACjB,QAAMC,OAAO,GAAGhB,UAAU,EAA1B;AACA,QAAMiB,OAAO,GAAGpB,MAAM,CAAC,IAAD,CAAtB;AACA,QAAM,CAACqB,SAAD,EAAYC,YAAZ,IAA4BrB,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM,CAACsB,gBAAD,EAAmBC,mBAAnB,IAA0CvB,QAAQ,CAAC,CAAD,CAAxD;AAGA,QAAMwB,aAAa,GAAG3B,OAAO,CAAC,MAAM;AAClC,WAAO4B,QAAQ,CAAC,CAACL,SAAS,IAAI,EAAd,EAAkBM,MAAlB,GAA2B,CAA5B,EAA+B,EAA/B,CAAR,GAA6C,CAApD;AACD,GAF4B,EAE1B,CAACN,SAAD,CAF0B,CAA7B;AAIA,QAAM,CAACO,mBAAD,EAAsBC,sBAAtB,IAAgD5B,QAAQ,CAAC,IAAD,CAA9D;AAEA,QAAM6B,gBAAgB,GAAGhC,OAAO,CAAC,MAAM;AACrC,QAAIiC,KAAK,CAACC,OAAN,CAAcX,SAAd,KAA4BA,SAAS,CAACM,MAAV,GAAmB,CAAnD,EAAsD;AACpD,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD,GAL+B,EAK7B,CAACN,SAAD,CAL6B,CAAhC;AAOA,QAAMY,gBAAgB,GAAGnC,OAAO,CAAC,MAAM;AACrC,QAAIyB,gBAAgB,IAAI,CAAxB,EAA2B;AACzB,aAAO,EAAP;AACD;;AACD,WAAOF,SAAS,CAACa,KAAV,CACL,CAACX,gBAAgB,GAAG,CAApB,IAAyB,CADpB,EAEL,CAACA,gBAAgB,GAAG,CAApB,IAAyB,CAFpB,CAAP;AAID,GAR+B,EAQ7B,CAACA,gBAAD,EAAmBF,SAAnB,CAR6B,CAAhC;AAUA,QAAMc,UAAU,GAAGrC,OAAO,CAAC,MAAM;AAC/B,WAAON,GAAG,CAAC4C,MAAJ,GAAaC,KAAb,CAAmB;AACxBC,MAAAA,IAAI,EAAE9C,GAAG,CAAC+C,MAAJ,GAAaC,QAAb,EADkB;AAExBC,MAAAA,MAAM,EAAEjD,GAAG,CACR+C,MADK,GAELG,QAFK,GAGLC,KAHK,CAGCC,MAAM,CAACC,IAAP,CAAYzC,OAAZ,CAHD,EAGuB,aAHvB,CAFgB;AAMxB0C,MAAAA,OAAO,EAAEtD,GAAG,CACTuD,KADM,GAENC,EAFM,CAEHxD,GAAG,CAAC+C,MAAJ,GAAaU,GAAb,CAAiB,CAAjB,CAFG,EAGNT,QAHM,GAINb,MAJM,CAICN,SAAS,CAACM,MAJX,CANe;AAWxBuB,MAAAA,QAAQ,EAAE1D,GAAG,CAAC2D,MAAJ,GAAaX,QAAb;AAXc,KAAnB,CAAP;AAaD,GAdyB,EAcvB,CAACnB,SAAD,CAduB,CAA1B;AAiBA,QAAM;AAAE+B,IAAAA,QAAF;AAAYC,IAAAA,YAAZ;AAA0BC,IAAAA,MAA1B;AAAkCC,IAAAA;AAAlC,MAA4C5D,OAAO,CAAC;AACxD6D,IAAAA,QAAQ,EAAE/D,WAAW,CAAC0C,UAAD,CADmC;AAExDsB,IAAAA,IAAI,EAAE,UAFkD;AAGxDC,IAAAA,aAAa,EAAE;AACbpB,MAAAA,IAAI,EAAE,EADO;AAEbG,MAAAA,MAAM,EAAE,EAFK;AAGbK,MAAAA,OAAO,EAAE,EAHI;AAIbI,MAAAA,QAAQ,EAAE,IAAIS,IAAJ,GAAWC,OAAX;AAJG;AAHyC,GAAD,CAAzD;AAWA,QAAMC,cAAc,GAAG/D,OAAO,CAAC,MAAM;AACnC,QAAI,CAACgC,gBAAL,EAAuB;AACrB,aAAO,KAAP;AACD;;AACD,QAAIP,gBAAgB,IAAI,CAAxB,EAA2B;AACzB,YAAM;AAAEkB,QAAAA,MAAF;AAAUH,QAAAA;AAAV,UAAmBiB,KAAK,EAA9B;AACA,aAAO,EAAEjB,IAAI,IAAIG,MAAV,CAAP;AACD;;AACD,UAAMK,OAAO,GAAGS,KAAK,CAAC,SAAD,CAArB;;AAEA,QAAI,CAACxB,KAAK,CAACC,OAAN,CAAcc,OAAd,CAAD,IAA2B,CAACf,KAAK,CAACC,OAAN,CAAcC,gBAAd,CAAhC,EAAiE;AAC/D,aAAO,KAAP;AACD;;AAED,WACEA,gBAAgB,CAAC6B,MAAjB,CAAwB,QAAiB;AAAA,UAAhB;AAAEC,QAAAA;AAAF,OAAgB;AACvC,aAAO,CAACjB,OAAO,CAACiB,OAAO,GAAG,CAAX,CAAf;AACD,KAFD,EAEGpC,MAFH,GAEY,CAHd;AAKD,GAnB6B,EAmB3B,CAACJ,gBAAD,EAAmBO,gBAAnB,EAAqCG,gBAArC,EAAuDsB,KAAvD,CAnB2B,CAA9B;AAqBA,QAAMS,QAAQ,GAAGpE,WAAW,CAC1B,MAAOqE,IAAP,IAAgB;AAAA;;AACd,UAAM;AAAE3B,MAAAA,IAAF;AAAQG,MAAAA,MAAR;AAAgBS,MAAAA;AAAhB,QAA6Be,IAAnC;AACA,UAAMnB,OAAO,GAAGmB,IAAH,aAAGA,IAAH,wCAAGA,IAAI,CAAEnB,OAAT,wEAAG,cACZoB,IADY,CACP,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACf,aAAO1C,QAAQ,CAACyC,CAAD,EAAI,EAAJ,CAAR,GAAkBzC,QAAQ,CAAC0C,CAAD,EAAI,EAAJ,CAA1B,GAAoC,CAApC,GAAwC,CAAC,CAAhD;AACD,KAHa,CAAH,uDAAG,mBAIZC,GAJY,CAIR,CAACC,MAAD,EAASC,KAAT,KAAmB;AACvB,aAAQ,IAAGA,KAAK,GAAG,CAAE,IAAGD,MAAO,EAA/B;AACD,KANa,EAObE,IAPa,CAOR,GAPQ,CAAhB;AAQA,UAAMC,GAAG,GAAG,MAAMvE,GAAG,CAACwE,IAAJ,CAASC,MAAT,CAAgB;AAAErC,MAAAA,IAAF;AAAQG,MAAAA,MAAR;AAAgBS,MAAAA,QAAhB;AAA0BJ,MAAAA;AAA1B,KAAhB,CAAlB;;AACA,QAAI2B,GAAJ,aAAIA,GAAJ,uBAAIA,GAAG,CAAEG,GAAT,EAAc;AACZ,YAAMC,GAAG,GAAG,CAACJ,GAAG,CAACG,GAAJ,GAAU,EAAX,EAAeE,KAAf,CAAqB,MAArB,EAA6BC,GAA7B,EAAZ;;AACA,UAAIF,GAAJ,EAAS;AACP1D,QAAAA,OAAO,CAAC6D,IAAR,CAAc,cAAaH,GAAI,EAA/B;AACD;AACF;;AACDI,IAAAA,OAAO,CAACC,GAAR,CAAYT,GAAZ;AACD,GAnByB,EAoB1B,CAACtD,OAAD,CApB0B,CAA5B;AAuBA,QAAMgE,eAAe,GAAGvF,WAAW,CAAC,MAAM;AACxC4B,IAAAA,mBAAmB,CAAE4D,OAAD,IAAa;AAC/B,aAAOA,OAAO,IAAI,CAAX,GAAe,CAAf,GAAmBA,OAAO,GAAG,CAApC;AACD,KAFkB,CAAnB;AAGD,GAJkC,EAIhC,EAJgC,CAAnC;AAMA,QAAMC,eAAe,GAAGzF,WAAW,CAAC,MAAM;AACxC,QAAIiE,cAAJ,EAAoB;AAClB;AACD;;AACDrC,IAAAA,mBAAmB,CAAE4D,OAAD,IAAa;AAC/B,aAAOA,OAAO,IAAI3D,aAAX,GAA2BA,aAA3B,GAA2C2D,OAAO,GAAG,CAA5D;AACD,KAFkB,CAAnB;AAGD,GAPkC,EAOhC,CAAC3D,aAAD,EAAgBoC,cAAhB,CAPgC,CAAnC;AASA,QAAMyB,cAAc,GAAG1F,WAAW,CAAC,YAAY;AAC7C,UAAM6E,GAAG,GAAG,MAAMvE,GAAG,CAACwE,IAAJ,CAASa,YAAT,EAAlB;;AACA,QAAIxD,KAAK,CAACC,OAAN,CAAcyC,GAAd,CAAJ,EAAwB;AACtBnD,MAAAA,YAAY,CAACmD,GAAD,CAAZ;AACD;AACF,GALiC,EAK/B,EAL+B,CAAlC;AAOA,QAAMe,kBAAkB,GAAG1F,OAAO,CAAC,MAAM;AACvC,UAAMgD,OAAO,GAAGS,KAAK,CAAC,SAAD,CAArB;;AACA,QAAIxB,KAAK,CAACC,OAAN,CAAcc,OAAd,KAA0BA,OAAO,CAACnB,MAAR,GAAiB,CAA/C,EAAkD;AAChD,aAAOD,QAAQ,CACZoB,OAAO,CAACgB,MAAR,CAAgBQ,MAAD,IAAY;AAC1B,eAAO,CAAC,CAACA,MAAT;AACD,OAFA,EAEE3C,MAFF,GAGCmB,OAAO,CAACnB,MAHV,GAIE,GALW,EAMb,EANa,CAAf;AAQD;;AACD,WAAO,CAAP;AACD,GAbiC,EAa/B,CAAC4B,KAAD,CAb+B,CAAlC;AAeA,QAAMkC,aAAa,GAAGlC,KAAK,CAAC,MAAD,CAA3B;AACA,QAAMmC,eAAe,GAAGnC,KAAK,CAAC,QAAD,CAA7B;AAGA1D,EAAAA,SAAS,CAAC,MAAM;AACdyF,IAAAA,cAAc;AACf,GAFQ,EAEN,CAACA,cAAD,CAFM,CAAT;AAKAzF,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI0B,gBAAgB,IAAI,CAAxB,EAA2B;AACzBM,MAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACD;AACF,GAJQ,EAIN,CAACN,gBAAD,CAJM,CAAT;AAMA,sBACE;AAAA,2BACA,QAAC,OAAD;AAAA,8BAEE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,cAFF,eAIE;AAAM,QAAA,GAAG,EAAEH,OAAX;AAAoB,QAAA,UAAU,MAA9B;AAA+B,QAAA,QAAQ,EAAEiC,YAAY,CAACW,QAAD,CAArD;AAAA,gCACE,QAAC,OAAD;AACE,UAAA,IAAI,EAAEyB,aADR;AAEE,UAAA,MAAM,EAAEC,eAFV;AAGE,UAAA,GAAG,EAAEtC,QAHP;AAIE,UAAA,SAAS,EAAE7B,gBAJb;AAKE,UAAA,MAAM,EAAE+B,MALV;AAME,UAAA,QAAQ,EAAEO,cANZ;AAOE,UAAA,OAAO,EAAEwB;AAPX;AAAA;AAAA;AAAA;AAAA,gBADF,EAUG9D,gBAAgB,KAAK,CAArB,iBACC,QAAC,WAAD;AACE,UAAA,gBAAgB,EAAEM,sBADpB;AAEE,UAAA,YAAY,EAAED,mBAFhB,CAEqC;AAFrC;AAGE,UAAA,QAAQ,EAAE,CAACA,mBAHb,CAGkC;AAHlC;AAIE,UAAA,SAAS,EAAEL,gBAJb;AAKE,UAAA,kBAAkB,EAAEiE,kBALtB;AAME,UAAA,QAAQ,EAAEL,eANZ;AAOE,UAAA,QAAQ,EAAEE;AAPZ;AAAA;AAAA;AAAA;AAAA,gBAXJ,eAsBE,QAAC,QAAD;AAAA,qBAEC9D,gBAAgB,GAAG,CAAnB,iBACC;AAAA,oCACA;AAAK,cAAA,SAAS,EAAC,MAAf;AAAA,qCACE,QAAC,WAAD;AAAa,gBAAA,IAAI,EAAE,OAAnB;AAA4B,gBAAA,UAAU,EAAEiE;AAAxC;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADA,eAKA,QAAC,KAAD;AAAA,0KAC4B;AAAA;AAAA;AAAA;AAAA,sBAD5B;AAAA;AAAA;AAAA;AAAA;AAAA,oBALA;AAAA,0BAHF,eAgBA,QAAC,YAAD;AAAc,YAAA,SAAS,EAAEnE,SAAzB;AAAoC,YAAA,gBAAgB,EAAEY,gBAAtD;AAAwE,YAAA,GAAG,EAAEmB;AAA7E;AAAA;AAAA;AAAA;AAAA,kBAhBA,EAmBC7B,gBAAgB,GAAG,CAAnB,iBACD;AAAA,mCACE;AAAK,cAAA,SAAS,EAAC,uCAAf;AAAA,sCAEA,QAAC,cAAD;AAAgB,gBAAA,SAAS,EAAC,QAA1B;AAAmC,gBAAA,IAAI,EAAE,UAAzC;AAAqD,gBAAA,QAAQ,EAAEA,gBAAgB,IAAI,CAAnF;AAAsF,gBAAA,IAAI,EAAE,IAA5F;AAAkG,gBAAA,OAAO,EAAE4D;AAA3G;AAAA;AAAA;AAAA;AAAA,sBAFA,eAIA,QAAC,cAAD;AACE,gBAAA,SAAS,EAAC,QADZ;AAEE,gBAAA,IAAI,EAAE5D,gBAAgB,IAAIE,aAApB,GAAoC,QAApC,GAA+C,QAFvD;AAGE,gBAAA,QAAQ,EAAEF,gBAAgB,IAAI,CAHhC;AAIE,gBAAA,IAAI,EAAEA,gBAAgB,KAAKE,aAArB,GAAqC,IAArC,GAA4C,IAJpD;AAKE,gBAAA,OAAO,EAAE4D;AALX;AAAA;AAAA;AAAA;AAAA,sBAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF,2BApBA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAtBF;AAAA;AAAA;AAAA;AAAA;AAAA,cAJF,eAiEE,QAAC,eAAD;AAAA;AAAA;AAAA;AAAA,cAjEF;AAAA;AAAA;AAAA;AAAA;AAAA;AADA,mBADF;AAwED,CAlOD;;GAAMnE,I;UACYf,U,EA8CkCR,O;;;MA/C9CuB,I;AAoON,kCAAenB,UAAU,CAACmB,IAAD,CAAzB","sourcesContent":["import * as yup from \"yup\";\nimport { yupResolver } from \"@hookform/resolvers/yup\";\nimport ko from \"yup-locales-ko\";\nimport { useForm } from \"react-hook-form\";\nimport { useCallback, useEffect, useMemo, forwardRef, useRef, useState } from \"react\";\nimport api from \"utils/api\";\nimport { useHistory } from \"react-router-dom\";\nimport { genders } from \"utils/constants\";\nimport styled from 'styled-components';\n\nimport Landing from '../Landing/index';\nimport TestExample from '../TestExample/index'\nimport QuestionList from \"./QuestionList\";\nimport ProgressBar from \"../../components/ProgressBarComponent\";\nimport Header from '../../components/HeaderComponent';\nimport FooterComponent from '../../components/FooterComponent';\nimport PageMoveButton from '../../components/PageMoveButtonComponent';\n\nyup.setLocale(ko);\n\n\nconst Boundary = styled.div `\n  margin: 4.0rem 4.8rem;\n  height: 100%;\n`\n\n\nconst Wrapper = styled.div`\n  background: linear-gradient(-20deg, #f794a4 0%, #fdd6bd 100%);\n  \n  height: 100%;\n  width: 100%;\n  padding-top: 0px;\n`\nconst Title = styled.div`\n    font-family:'Binggrae-Bold';\n    font-size:1.5rem;\n    text-shadow: 1px 2px 1.5px rgba(0, 0, 0, 0.25);\n    text-align:center;\n    color:#FFFFFF;\n    margin-bottom:2rem;\n`\n\nconst Test = () => {\n  const history = useHistory();\n  const formRef = useRef(null);\n  const [questions, setQuestions] = useState([]);\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\n\n  \n  const lastPageIndex = useMemo(() => {\n    return parseInt((questions || []).length / 5, 10) + 2;\n  }, [questions]);\n\n  const [selectedSampleValue, setSelectedSampleValue] = useState(null);\n\n  const isQuestionLoaded = useMemo(() => {\n    if (Array.isArray(questions) && questions.length > 0) {\n      return true;\n    }\n    return false;\n  }, [questions]);\n\n  const visibleQuestions = useMemo(() => {\n    if (currentPageIndex <= 1) {\n      return [];\n    }\n    return questions.slice(\n      (currentPageIndex - 2) * 5,\n      (currentPageIndex - 1) * 5\n    );\n  }, [currentPageIndex, questions]);\n\n  const formSchema = useMemo(() => {\n    return yup.object().shape({\n      name: yup.string().required(),\n      gender: yup\n        .string()\n        .nullable()\n        .oneOf(Object.keys(genders), \"성별을 입력해주세요.\"),\n      answers: yup\n        .array()\n        .of(yup.string().min(1))\n        .required()\n        .length(questions.length),\n      startDtm: yup.number().required(),\n    });\n  }, [questions]);\n\n\n  const { register, handleSubmit, errors, watch } = useForm({\n    resolver: yupResolver(formSchema),\n    mode: \"onChange\",\n    defaultValues: {\n      name: \"\",\n      gender: \"\",\n      answers: [],\n      startDtm: new Date().getTime(),\n    },\n  });\n\n  const isNextDisabled = useMemo(() => {\n    if (!isQuestionLoaded) {\n      return false;\n    }\n    if (currentPageIndex <= 0) {\n      const { gender, name } = watch();\n      return !(name && gender);\n    }\n    const answers = watch(\"answers\");\n\n    if (!Array.isArray(answers) || !Array.isArray(visibleQuestions)) {\n      return false;\n    }\n\n    return (\n      visibleQuestions.filter(({ qitemNo }) => {\n        return !answers[qitemNo - 1];\n      }).length > 0\n    );\n  }, [currentPageIndex, isQuestionLoaded, visibleQuestions, watch]);\n\n  const onSubmit = useCallback(\n    async (data) => {\n      const { name, gender, startDtm } = data;\n      const answers = data?.answers\n        ?.sort((a, b) => {\n          return parseInt(a, 10) > parseInt(b, 10) ? 1 : -1;\n        })\n        ?.map((answer, index) => {\n          return `B${index + 1}=${answer}`;\n        })\n        .join(\" \");\n      const res = await api.test.submit({ name, gender, startDtm, answers });\n      if (res?.url) {\n        const seq = (res.url + \"\").split(\"seq=\").pop();\n        if (seq) {\n          history.push(`/completed/${seq}`);\n        }\n      }\n      console.log(res);\n    },\n    [history]\n  );\n\n  const handlePrevClick = useCallback(() => {\n    setCurrentPageIndex((current) => {\n      return current <= 0 ? 0 : current - 1;\n    });\n  }, []);\n\n  const handleNextClick = useCallback(() => {\n    if (isNextDisabled) {\n      return;\n    }\n    setCurrentPageIndex((current) => {\n      return current >= lastPageIndex ? lastPageIndex : current + 1;\n    });\n  }, [lastPageIndex, isNextDisabled]);\n\n  const fetchQuestions = useCallback(async () => {\n    const res = await api.test.getQuestions();\n    if (Array.isArray(res)) {\n      setQuestions(res);\n    }\n  }, []);\n\n  const progressPercentage = useMemo(() => {\n    const answers = watch(\"answers\");\n    if (Array.isArray(answers) && answers.length > 0) {\n      return parseInt(\n        (answers.filter((answer) => {\n          return !!answer;\n        }).length /\n          answers.length) *\n          100,\n        10\n      );\n    }\n    return 0;\n  }, [watch]);\n\n  const watchUserName = watch(\"name\");\n  const watchUserGender = watch(\"gender\");\n\n\n  useEffect(() => {\n    fetchQuestions();\n  }, [fetchQuestions]);\n\n\n  useEffect(() => {\n    if (currentPageIndex <= 0) {\n      setSelectedSampleValue(null);\n    }\n  }, [currentPageIndex]);\n\n  return (\n    <>\n    <Wrapper>\n    {/* <div className=\"container\"> */}\n      <Header />\n      \n      <form ref={formRef} noValidate onSubmit={handleSubmit(onSubmit)}>\n        <Landing \n          name={watchUserName}\n          gender={watchUserGender}\n          ref={register} \n          pageIndex={currentPageIndex} \n          errors={errors} \n          disabled={isNextDisabled} \n          onClick={handleNextClick} />\n\n        {currentPageIndex === 1 && (\n          <TestExample \n            setSelectedValue={setSelectedSampleValue}\n            initialValue={selectedSampleValue} // 지금은 null값이 들어있다.\n            disabled={!selectedSampleValue} // disabled true로 되어있나?\n            pageIndex={currentPageIndex} \n            progressPercentage={progressPercentage}\n            onClick1={handlePrevClick}\n            onClick2={handleNextClick}\n          />\n        )}\n\n        <Boundary>\n        {/* 본격적으로 검사 시작 */}\n        {currentPageIndex > 1 && (\n          <>\n          <div className=\"mb-4\">\n            <ProgressBar text={'검사 진행'} percentage={progressPercentage} />\n          </div>\n\n          <Title>\n          다음 선택지의 직업과 관련된 두 개의 가치 중에서 <br/> 자신에게 더 중요한 가치를\n          선택하세요.\n        </Title>\n        </>\n        )}\n        \n\n        <QuestionList questions={questions} visibleQuestions={visibleQuestions} ref={register} />\n        \n        {/* 아래 버튼들 */}\n        {currentPageIndex > 1 && (\n        <>\n          <div className=\"button d-flex justify-content-between\">\n\n          <PageMoveButton className='button' type={'previous'} disabled={currentPageIndex <= 0} text={'이전'} onClick={handlePrevClick} />\n  \n          <PageMoveButton \n            className='button'\n            type={currentPageIndex >= lastPageIndex ? \"submit\" : \"button\"} \n            disabled={currentPageIndex <= 0} \n            text={currentPageIndex === lastPageIndex ? \"제출\" : \"다음\"}\n            onClick={handleNextClick}>\n          </PageMoveButton>\n\n          </div>\n        </>\n        )}\n        </Boundary>\n        \n      </form>\n      <FooterComponent />\n    {/* </div> */}\n    </Wrapper>\n    </>\n  );\n};\n\nexport default forwardRef(Test);\n"]},"metadata":{},"sourceType":"module"}